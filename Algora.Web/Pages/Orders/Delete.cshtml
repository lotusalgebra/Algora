@page "/orders/delete/{id:long}"
@model Algora.Web.Pages.Orders.DeleteModel
@{
    ViewData["Title"] = "Close Order";
}

<div class="p-4">
    <!-- Breadcrumb -->
    <nav class="flex mb-4" aria-label="Breadcrumb">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
            <li class="inline-flex items-center">
                <a href="/orders" class="inline-flex items-center text-sm font-medium text-gray-500 hover:text-purple-600 dark:text-gray-400 dark:hover:text-white">
                    <i class="fas fa-shopping-cart me-2"></i> Orders
                </a>
            </li>
            <li>
                <div class="flex items-center">
                    <i class="fas fa-chevron-right text-gray-400 text-xs mx-2"></i>
                    <span class="text-sm font-medium text-gray-700 dark:text-white">Close/Cancel Order</span>
                </div>
            </li>
        </ol>
    </nav>

    <div class="flex justify-center">
        <div class="w-full max-w-2xl">
            <!-- Error Message -->
            @if (!string.IsNullOrEmpty(Model.ErrorMessage))
            {
                <div class="flex items-center p-4 mb-6 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    @Model.ErrorMessage
                </div>
            }

            @if (Model.Order != null)
            {
                <!-- Action Selection Card -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
                    <div class="p-6 text-center border-b border-gray-200 dark:border-gray-700">
                        <div class="w-16 h-16 mx-auto mb-4 flex items-center justify-center rounded-full bg-amber-100 dark:bg-amber-900/30">
                            <i class="fas fa-exclamation-circle text-amber-500 text-2xl"></i>
                        </div>
                        <h5 class="text-lg font-bold text-gray-900 dark:text-white mb-2">Close or Cancel Order</h5>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Choose an action for order @Model.Order.Name</p>
                    </div>

                    <div class="p-6">
                        <!-- Order Summary -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-6">
                            <div class="flex items-start">
                                <div class="flex items-center justify-center w-12 h-12 mr-4 text-sm font-bold text-white rounded-lg bg-gradient-to-br from-purple-600 to-pink-500">
                                    <i class="fas fa-shopping-bag"></i>
                                </div>
                                <div class="flex-1">
                                    <h6 class="font-semibold text-gray-900 dark:text-white mb-1">@Model.Order.Name</h6>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        @Model.Order.Email
                                    </p>
                                    <div class="flex flex-wrap gap-2 mt-2">
                                        @{
                                            var paymentBadgeClass = Model.Order.FinancialStatus?.ToLower() switch
                                            {
                                                "paid" => "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",
                                                "pending" => "bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",
                                                "refunded" => "bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",
                                                _ => "bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-300"
                                            };
                                        }
                                        <span class="px-2 py-0.5 text-xs font-medium rounded @paymentBadgeClass">
                                            @(Model.Order.FinancialStatus ?? "Unknown")
                                        </span>
                                        @{
                                            var fulfillmentBadgeClass = Model.Order.FulfillmentStatus?.ToLower() switch
                                            {
                                                "fulfilled" => "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",
                                                "partial" => "bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",
                                                _ => "bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-300"
                                            };
                                        }
                                        <span class="px-2 py-0.5 text-xs font-medium rounded @fulfillmentBadgeClass">
                                            @(Model.Order.FulfillmentStatus ?? "Unfulfilled")
                                        </span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="text-lg font-bold text-gray-900 dark:text-white">@Model.Order.TotalPrice.ToString("C")</span>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">
                                        @Model.Order.CreatedAt.ToString("MMM dd, yyyy")
                                    </p>
                                </div>
                            </div>

                            <!-- Line Items -->
                            @if (Model.Order.LineItems?.Any() == true)
                            {
                                <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-600">
                                    <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase mb-2">
                                        <i class="fas fa-box me-1"></i> @Model.Order.LineItems.Count() Item(s)
                                    </p>
                                    <div class="space-y-1">
                                        @foreach (var item in Model.Order.LineItems.Take(3))
                                        {
                                            <div class="flex justify-between text-sm">
                                                <span class="text-gray-600 dark:text-gray-300">@item.Title x @item.Quantity</span>
                                                <span class="font-semibold text-gray-900 dark:text-white">@item.Price.ToString("C")</span>
                                            </div>
                                        }
                                        @if (Model.Order.LineItems.Count() > 3)
                                        {
                                            <p class="text-xs text-gray-400 dark:text-gray-500">
                                                ... and @(Model.Order.LineItems.Count() - 3) more item(s)
                                            </p>
                                        }
                                    </div>
                                </div>
                            }
                        </div>

                        <!-- Action Options -->
                        <form method="post" asp-route-id="@Model.Order.Id">
                            <div class="space-y-4 mb-6">
                                <!-- Close Option -->
                                <label class="flex items-start p-4 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer hover:border-purple-300 dark:hover:border-purple-700 transition-colors has-[:checked]:border-purple-500 has-[:checked]:bg-purple-50 dark:has-[:checked]:bg-purple-900/20">
                                    <input type="radio" name="Action" value="close" checked class="mt-1 w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 focus:ring-purple-500 dark:focus:ring-purple-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600" />
                                    <div class="ml-3">
                                        <span class="font-semibold text-gray-900 dark:text-white">Close Order</span>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">
                                            Mark the order as closed. This is typically done when the order has been fulfilled and completed.
                                        </p>
                                    </div>
                                </label>

                                <!-- Cancel Option -->
                                <label class="flex items-start p-4 border-2 border-gray-200 dark:border-gray-600 rounded-lg cursor-pointer hover:border-red-300 dark:hover:border-red-700 transition-colors has-[:checked]:border-red-500 has-[:checked]:bg-red-50 dark:has-[:checked]:bg-red-900/20">
                                    <input type="radio" name="Action" value="cancel" class="mt-1 w-4 h-4 text-red-600 bg-gray-100 border-gray-300 focus:ring-red-500 dark:focus:ring-red-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600" />
                                    <div class="ml-3">
                                        <span class="font-semibold text-gray-900 dark:text-white">Cancel Order</span>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">
                                            Cancel the order completely. Use this if the customer requested cancellation or the order cannot be fulfilled.
                                        </p>
                                    </div>
                                </label>
                            </div>

                            <!-- Warning -->
                            <div class="flex p-4 mb-6 text-sm text-amber-800 rounded-lg bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800" role="alert">
                                <i class="fas fa-info-circle mt-0.5 me-3 text-amber-500"></i>
                                <div>
                                    <h6 class="font-semibold text-amber-800 dark:text-amber-400 mb-1">Important</h6>
                                    <p class="text-xs text-amber-700 dark:text-amber-300">
                                        Shopify does not allow permanent deletion of orders. You can either close an order (mark it as complete) or cancel it.
                                        Both actions can be reversed from the Shopify admin if needed.
                                    </p>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="flex flex-col sm:flex-row gap-3">
                                <button type="submit" class="flex-1 text-white bg-gradient-to-br from-amber-500 to-orange-400 hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-amber-300 dark:focus:ring-amber-800 font-medium rounded-lg text-sm px-5 py-3">
                                    <i class="fas fa-check me-2"></i> Confirm Action
                                </button>
                                <a href="/orders" class="flex-1 text-center text-gray-900 bg-white border border-gray-300 focus:outline-none hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg text-sm px-5 py-3 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700">
                                    <i class="fas fa-times me-2"></i> Cancel
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            }
            else
            {
                <!-- Order Not Found -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
                    <div class="p-6 text-center">
                        <div class="w-16 h-16 mx-auto mb-4 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-700">
                            <i class="fas fa-question text-gray-400 text-2xl"></i>
                        </div>
                        <h5 class="text-lg font-bold text-gray-900 dark:text-white mb-2">Order Not Found</h5>
                        <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">The order you're trying to access could not be found.</p>
                        <a href="/orders" class="inline-flex items-center px-5 py-2.5 text-sm font-medium text-white bg-gradient-to-br from-purple-600 to-pink-500 rounded-lg hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-purple-300 dark:focus:ring-purple-800">
                            <i class="fas fa-arrow-left me-2"></i> Back to Orders
                        </a>
                    </div>
                </div>
            }
        </div>
    </div>
</div>
