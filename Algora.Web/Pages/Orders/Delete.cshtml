@page "/orders/delete/{id:long}"
@model Algora.Web.Pages.Orders.DeleteModel
@{
    ViewData["Title"] = "Close Order";
}

<div class="w-full px-6 py-6 mx-auto">
    <!-- Breadcrumb -->
    <nav class="mb-4">
        <ol class="flex flex-wrap pt-1 mr-12 bg-transparent rounded-lg sm:mr-16">
            <li class="leading-normal text-sm">
                <a class="text-slate-500 dark:text-white/60" href="/orders">Orders</a>
            </li>
            <li class="text-sm pl-2 capitalize leading-normal before:float-left before:pr-2 before:content-['/'] text-slate-700 dark:text-white" aria-current="page">
                Close/Cancel Order
            </li>
        </ol>
    </nav>

    <div class="flex flex-wrap -mx-3 justify-center">
        <div class="w-full max-w-full px-3 md:w-8/12 lg:w-6/12">
            <!-- Error Message -->
            @if (!string.IsNullOrEmpty(Model.ErrorMessage))
            {
                <div class="mb-6 p-4 text-sm text-red-700 bg-red-100 rounded-lg dark:bg-red-200 dark:text-red-800" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    @Model.ErrorMessage
                </div>
            }

            @if (Model.Order != null)
            {
                <!-- Action Selection Card -->
                <div class="relative flex flex-col min-w-0 mb-6 break-words bg-white border-0 shadow-soft-xl rounded-2xl bg-clip-border dark:bg-gray-950 dark:shadow-soft-dark-xl">
                    <div class="p-6 text-center border-b-0 rounded-t-2xl">
                        <div class="w-16 h-16 mx-auto mb-4 flex items-center justify-center rounded-full bg-amber-100 dark:bg-amber-900/30">
                            <i class="fas fa-exclamation-circle text-amber-500 text-2xl"></i>
                        </div>
                        <h5 class="mb-2 font-bold dark:text-white">Close or Cancel Order</h5>
                        <p class="mb-0 text-sm text-slate-500 dark:text-white/60">Choose an action for order @Model.Order.Name</p>
                    </div>

                    <div class="flex-auto p-6 pt-0">
                        <!-- Order Summary -->
                        <div class="bg-slate-50 dark:bg-gray-900 rounded-xl p-4 mb-6">
                            <div class="flex items-start">
                                <div class="flex items-center justify-center w-12 h-12 mr-4 text-sm font-bold text-white rounded-xl bg-gradient-to-tl from-cyan-500 to-blue-500">
                                    <i class="fas fa-shopping-bag"></i>
                                </div>
                                <div class="flex-1">
                                    <h6 class="mb-1 font-semibold dark:text-white">@Model.Order.Name</h6>
                                    <p class="mb-0 text-xs text-slate-500 dark:text-white/60">
                                        @Model.Order.Email
                                    </p>
                                    <div class="flex flex-wrap gap-2 mt-2">
                                        @{
                                            var paymentBadgeClass = Model.Order.FinancialStatus?.ToLower() switch
                                            {
                                                "paid" => "bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",
                                                "pending" => "bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",
                                                "refunded" => "bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",
                                                _ => "bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300"
                                            };
                                        }
                                        <span class="px-2 py-0.5 text-xs font-medium rounded @paymentBadgeClass">
                                            @(Model.Order.FinancialStatus ?? "Unknown")
                                        </span>
                                        @{
                                            var fulfillmentBadgeClass = Model.Order.FulfillmentStatus?.ToLower() switch
                                            {
                                                "fulfilled" => "bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",
                                                "partial" => "bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",
                                                _ => "bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300"
                                            };
                                        }
                                        <span class="px-2 py-0.5 text-xs font-medium rounded @fulfillmentBadgeClass">
                                            @(Model.Order.FulfillmentStatus ?? "Unfulfilled")
                                        </span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <span class="text-lg font-bold dark:text-white">@Model.Order.TotalPrice.ToString("C")</span>
                                    <p class="mb-0 text-xs text-slate-500 dark:text-white/60">
                                        @Model.Order.CreatedAt.ToString("MMM dd, yyyy")
                                    </p>
                                </div>
                            </div>

                            <!-- Line Items -->
                            @if (Model.Order.LineItems?.Any() == true)
                            {
                                <div class="mt-4 pt-4 border-t border-slate-200 dark:border-gray-700">
                                    <p class="text-xs font-semibold text-slate-500 dark:text-white/60 uppercase mb-2">
                                        <i class="fas fa-box me-1"></i> @Model.Order.LineItems.Count() Item(s)
                                    </p>
                                    <div class="space-y-1">
                                        @foreach (var item in Model.Order.LineItems.Take(3))
                                        {
                                            <div class="flex justify-between text-sm">
                                                <span class="text-slate-600 dark:text-white/80">@item.Title x @item.Quantity</span>
                                                <span class="font-semibold dark:text-white">@item.Price.ToString("C")</span>
                                            </div>
                                        }
                                        @if (Model.Order.LineItems.Count() > 3)
                                        {
                                            <p class="text-xs text-slate-400 dark:text-white/50">
                                                ... and @(Model.Order.LineItems.Count() - 3) more item(s)
                                            </p>
                                        }
                                    </div>
                                </div>
                            }
                        </div>

                        <!-- Action Options -->
                        <form method="post" asp-route-id="@Model.Order.Id">
                            <div class="space-y-4 mb-6">
                                <!-- Close Option -->
                                <label class="flex items-start p-4 border-2 border-slate-200 dark:border-gray-700 rounded-xl cursor-pointer hover:border-cyan-300 dark:hover:border-cyan-700 transition-colors has-[:checked]:border-cyan-500 has-[:checked]:bg-cyan-50 dark:has-[:checked]:bg-cyan-900/20">
                                    <input type="radio" name="Action" value="close" checked class="mt-1 w-4 h-4 text-cyan-500 border-slate-300 focus:ring-cyan-500" />
                                    <div class="ml-3">
                                        <span class="font-semibold dark:text-white">Close Order</span>
                                        <p class="text-sm text-slate-500 dark:text-white/60 mb-0">
                                            Mark the order as closed. This is typically done when the order has been fulfilled and completed.
                                        </p>
                                    </div>
                                </label>

                                <!-- Cancel Option -->
                                <label class="flex items-start p-4 border-2 border-slate-200 dark:border-gray-700 rounded-xl cursor-pointer hover:border-red-300 dark:hover:border-red-700 transition-colors has-[:checked]:border-red-500 has-[:checked]:bg-red-50 dark:has-[:checked]:bg-red-900/20">
                                    <input type="radio" name="Action" value="cancel" class="mt-1 w-4 h-4 text-red-500 border-slate-300 focus:ring-red-500" />
                                    <div class="ml-3">
                                        <span class="font-semibold dark:text-white">Cancel Order</span>
                                        <p class="text-sm text-slate-500 dark:text-white/60 mb-0">
                                            Cancel the order completely. Use this if the customer requested cancellation or the order cannot be fulfilled.
                                        </p>
                                    </div>
                                </label>
                            </div>

                            <!-- Warning -->
                            <div class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-xl p-4 mb-6">
                                <div class="flex">
                                    <i class="fas fa-info-circle text-amber-500 mt-0.5 me-3"></i>
                                    <div>
                                        <h6 class="text-sm font-semibold text-amber-800 dark:text-amber-400 mb-1">Important</h6>
                                        <p class="text-xs text-amber-700 dark:text-amber-300 mb-0">
                                            Shopify does not allow permanent deletion of orders. You can either close an order (mark it as complete) or cancel it.
                                            Both actions can be reversed from the Shopify admin if needed.
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="flex flex-col sm:flex-row gap-3">
                                <button type="submit" class="flex-1 inline-flex items-center justify-center px-6 py-3 text-sm font-bold text-white uppercase transition-all border-0 rounded-lg cursor-pointer hover:scale-102 active:opacity-85 bg-gradient-to-tl from-amber-600 to-orange-400 shadow-soft-md">
                                    <i class="fas fa-check me-2"></i> Confirm Action
                                </button>
                                <a href="/orders" class="flex-1 inline-flex items-center justify-center px-6 py-3 text-sm font-bold text-center uppercase transition-all border border-solid rounded-lg cursor-pointer border-slate-200 text-slate-500 hover:bg-slate-100 dark:border-gray-600 dark:text-white dark:hover:bg-gray-700">
                                    <i class="fas fa-times me-2"></i> Cancel
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            }
            else
            {
                <!-- Order Not Found -->
                <div class="relative flex flex-col min-w-0 mb-6 break-words bg-white border-0 shadow-soft-xl rounded-2xl bg-clip-border dark:bg-gray-950 dark:shadow-soft-dark-xl">
                    <div class="p-6 text-center">
                        <div class="w-16 h-16 mx-auto mb-4 flex items-center justify-center rounded-full bg-slate-100 dark:bg-gray-800">
                            <i class="fas fa-question text-slate-400 text-2xl"></i>
                        </div>
                        <h5 class="mb-2 font-bold dark:text-white">Order Not Found</h5>
                        <p class="mb-4 text-sm text-slate-500 dark:text-white/60">The order you're trying to access could not be found.</p>
                        <a href="/orders" class="inline-flex items-center justify-center px-6 py-3 text-sm font-bold text-white uppercase transition-all border-0 rounded-lg cursor-pointer hover:scale-102 active:opacity-85 bg-gradient-to-tl from-purple-700 to-pink-500 shadow-soft-md">
                            <i class="fas fa-arrow-left me-2"></i> Back to Orders
                        </a>
                    </div>
                </div>
            }
        </div>
    </div>
</div>
