@page "/products/create"
@model Algora.Web.Pages.Products.CreateModel
@{
    ViewData["Title"] = "Add Product";
    ViewData["Breadcrumb"] = "Products / New Product";
}

<div class="p-4">
    <!-- Header -->
    <div class="flex flex-wrap items-center justify-between gap-4 mb-6">
        <div>
            <h5 class="text-xl font-semibold text-gray-900 dark:text-white">Create New Product</h5>
            <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Add a new product to your store</p>
        </div>
        <a href="/products" class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700 dark:focus:ring-gray-700">
            <i class="fas fa-arrow-left me-2"></i> Back to Products
        </a>
    </div>

    <!-- Error Message -->
    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="flex items-center p-4 mb-6 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400" role="alert">
            <i class="fas fa-exclamation-triangle flex-shrink-0 me-2"></i>
            <span>@Model.ErrorMessage</span>
        </div>
    }

    <!-- Form -->
    <form method="post" enctype="multipart/form-data">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column - Product Info -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Product Information Card -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                        <h6 class="text-lg font-semibold text-gray-900 dark:text-white">Product Information</h6>
                    </div>
                    <div class="p-6 space-y-4">
                        <div>
                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" for="Product_Title">
                                Product Title <span class="text-red-500">*</span>
                            </label>
                            <input type="text" asp-for="Product.Title"
                                   class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                                   placeholder="e.g. Classic T-Shirt" />
                            <span asp-validation-for="Product.Title" class="mt-1 text-sm text-red-600 dark:text-red-500"></span>
                        </div>

                        <div>
                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" for="Product_Description">
                                Description
                            </label>
                            <textarea asp-for="Product.Description" rows="4"
                                      class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                                      placeholder="Describe your product..."></textarea>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" for="Product_Vendor">
                                    Vendor
                                </label>
                                <input type="text" asp-for="Product.Vendor"
                                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                                       placeholder="e.g. Nike" />
                            </div>

                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" for="Product_ProductType">
                                    Product Type
                                </label>
                                <input type="text" asp-for="Product.ProductType"
                                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                                       placeholder="e.g. Clothing" />
                            </div>
                        </div>

                        <div>
                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white" for="Product_Tags">
                                Tags <span class="text-xs font-normal text-gray-500">(comma-separated)</span>
                            </label>
                            <input type="text" asp-for="Product.Tags"
                                   class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                                   placeholder="e.g. summer, sale, new-arrival" />
                        </div>
                    </div>
                </div>

                <!-- Product Images Card -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                        <h6 class="text-lg font-semibold text-gray-900 dark:text-white">
                            <i class="fas fa-images me-2 text-purple-500"></i>Product Images
                        </h6>
                        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Upload images or add URLs for your product</p>
                    </div>
                    <div class="p-6 space-y-6">
                        <!-- File Upload Section -->
                        <div>
                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                <i class="fas fa-upload me-1"></i> Upload Images
                            </label>
                            <div id="file-drop-zone" class="flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 dark:bg-gray-700 dark:border-gray-600 dark:hover:border-purple-500 dark:hover:bg-gray-600 transition-colors">
                                <input type="file" name="ImageFiles" id="file-input" multiple accept="image/*" class="hidden" />
                                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 dark:text-gray-500 mb-3"></i>
                                    <p class="mb-2 text-sm text-gray-500 dark:text-gray-400">
                                        <span class="font-semibold text-purple-600 dark:text-purple-400">Click to upload</span> or drag and drop
                                    </p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400">JPG, PNG, GIF, WebP (max 10MB each)</p>
                                </div>
                            </div>
                            <div id="file-preview" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 mt-4"></div>
                        </div>

                        <!-- URL Input Section -->
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                            <div class="flex items-center justify-between mb-3">
                                <label class="text-sm font-medium text-gray-900 dark:text-white">
                                    <i class="fas fa-link me-1"></i> Or Add Image URLs
                                </label>
                                <button type="button" id="add-image-btn" class="inline-flex items-center px-3 py-1.5 text-xs font-medium text-white bg-gradient-to-r from-cyan-500 to-blue-500 rounded-lg hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-cyan-300 dark:focus:ring-cyan-800">
                                    <i class="fas fa-plus me-1"></i> Add URL
                                </button>
                            </div>
                            <div id="images-container">
                                <div class="image-row flex items-center gap-3 mb-3" data-index="0">
                                    <input type="url" name="ImageUrls[0]"
                                           class="image-url bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                                           placeholder="https://example.com/image.jpg" />
                                    <button type="button" class="remove-image-btn hidden text-red-500 hover:text-red-700 p-2" title="Remove">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Variants Card -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <h6 class="text-lg font-semibold text-gray-900 dark:text-white">
                                    <i class="fas fa-layer-group me-2 text-purple-500"></i>Variants
                                    <span class="text-xs font-normal text-gray-500">(Optional)</span>
                                </h6>
                                <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Add variants if your product has different options</p>
                            </div>
                            <button type="button" id="toggle-variants-btn" class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-gradient-to-br from-purple-600 to-pink-500 rounded-lg hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-purple-300 dark:focus:ring-purple-800">
                                <i class="fas fa-plus me-1" id="toggle-icon"></i> <span id="toggle-text">Add Variants</span>
                            </button>
                        </div>
                    </div>
                    <div class="p-6 hidden" id="variants-section">
                        <div class="flex justify-end mb-4">
                            <button type="button" id="add-variant-btn" class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-gray-900 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700">
                                <i class="fas fa-plus me-1"></i> Add Another Variant
                            </button>
                        </div>
                        <div id="variants-container"></div>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
                            <i class="fas fa-info-circle me-1"></i> Leave variants empty if your product doesn't have different options.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Right Column - Actions -->
            <div class="space-y-6">
                <!-- Actions Card -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md sticky top-6">
                    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                        <h6 class="text-lg font-semibold text-gray-900 dark:text-white">Actions</h6>
                    </div>
                    <div class="p-6 space-y-3">
                        <button type="submit" class="w-full inline-flex items-center justify-center px-5 py-3 text-sm font-medium text-white bg-gradient-to-br from-purple-600 to-pink-500 rounded-lg hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-purple-300 dark:focus:ring-purple-800">
                            <i class="fas fa-save me-2"></i> Create Product
                        </button>
                        <a href="/products" class="w-full inline-flex items-center justify-center px-5 py-3 text-sm font-medium text-gray-900 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700">
                            <i class="fas fa-times me-2"></i> Cancel
                        </a>
                    </div>
                </div>

                <!-- Image Preview Card -->
                <div id="thumbnail-preview-card" class="bg-white dark:bg-gray-800 rounded-lg shadow-md hidden">
                    <div class="p-4">
                        <div class="flex items-center gap-2 mb-3">
                            <i class="fas fa-images text-purple-500"></i>
                            <h6 class="font-semibold text-sm text-gray-900 dark:text-white">Image Preview</h6>
                            <span id="thumbnail-count" class="text-xs bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300 px-2 py-0.5 rounded-full">0</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <div id="main-thumbnail" class="w-20 h-20 rounded-lg overflow-hidden border-2 border-purple-300 dark:border-purple-600 shadow-md flex-shrink-0 bg-gray-100 dark:bg-gray-700 flex items-center justify-center">
                                <i class="fas fa-image text-2xl text-gray-300 dark:text-gray-600"></i>
                            </div>
                            <div id="additional-thumbnails" class="flex flex-wrap gap-1"></div>
                        </div>
                    </div>
                </div>

                <!-- Tips Card -->
                <div class="bg-gradient-to-br from-purple-600 to-pink-500 rounded-lg shadow-md">
                    <div class="p-6">
                        <div class="flex items-center mb-4">
                            <i class="fas fa-lightbulb text-white text-xl me-3"></i>
                            <h6 class="font-semibold text-white">Tips</h6>
                        </div>
                        <ul class="text-sm text-white/80 space-y-2">
                            <li><i class="fas fa-check me-2 text-white/60"></i> Use descriptive product titles</li>
                            <li><i class="fas fa-check me-2 text-white/60"></i> Add high-quality images</li>
                            <li><i class="fas fa-check me-2 text-white/60"></i> Variants are optional</li>
                            <li><i class="fas fa-check me-2 text-white/60"></i> Use tags to organize products</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const imagesContainer = document.getElementById('images-container');
            const addImageBtn = document.getElementById('add-image-btn');
            const variantsContainer = document.getElementById('variants-container');
            const variantsSection = document.getElementById('variants-section');
            const toggleVariantsBtn = document.getElementById('toggle-variants-btn');
            const toggleIcon = document.getElementById('toggle-icon');
            const toggleText = document.getElementById('toggle-text');
            const addVariantBtn = document.getElementById('add-variant-btn');
            const fileDropZone = document.getElementById('file-drop-zone');
            const fileInput = document.getElementById('file-input');
            const filePreview = document.getElementById('file-preview');

            let variantsVisible = false;
            let selectedFiles = new DataTransfer();

            // File Upload
            fileDropZone.addEventListener('click', () => fileInput.click());

            fileDropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileDropZone.classList.add('border-purple-400', 'bg-purple-50', 'dark:bg-purple-900/20');
            });

            fileDropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                fileDropZone.classList.remove('border-purple-400', 'bg-purple-50', 'dark:bg-purple-900/20');
            });

            fileDropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                fileDropZone.classList.remove('border-purple-400', 'bg-purple-50', 'dark:bg-purple-900/20');
                handleFiles(e.dataTransfer.files);
            });

            fileInput.addEventListener('change', (e) => handleFiles(e.target.files));

            function handleFiles(files) {
                for (const file of files) {
                    if (!file.type.startsWith('image/')) { alert(`${file.name} is not an image.`); continue; }
                    if (file.size > 10 * 1024 * 1024) { alert(`${file.name} is too large.`); continue; }
                    selectedFiles.items.add(file);
                }
                fileInput.files = selectedFiles.files;
                renderPreviews();
            }

            function renderPreviews() {
                filePreview.innerHTML = '';
                const thumbnailCard = document.getElementById('thumbnail-preview-card');
                const mainThumbnail = document.getElementById('main-thumbnail');
                const additionalThumbnails = document.getElementById('additional-thumbnails');
                const thumbnailCount = document.getElementById('thumbnail-count');

                thumbnailCard.classList.toggle('hidden', selectedFiles.files.length === 0);
                thumbnailCount.textContent = selectedFiles.files.length;
                additionalThumbnails.innerHTML = '';

                for (let i = 0; i < selectedFiles.files.length; i++) {
                    const file = selectedFiles.files[i];
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const preview = document.createElement('div');
                        preview.className = 'relative group';
                        preview.innerHTML = `
                            <img src="${e.target.result}" alt="${file.name}" class="w-full h-24 object-cover rounded-lg border border-gray-200 dark:border-gray-700" />
                            <button type="button" data-index="${i}" class="remove-file-btn absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-xs">
                                <i class="fas fa-times"></i>
                            </button>
                            <p class="text-xs text-gray-500 truncate mt-1">${file.name}</p>
                        `;
                        filePreview.appendChild(preview);
                        preview.querySelector('.remove-file-btn').addEventListener('click', () => removeFile(i));

                        if (i === 0) mainThumbnail.innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover" />`;
                        else if (i < 5) {
                            const thumb = document.createElement('div');
                            thumb.className = 'w-7 h-7 rounded overflow-hidden border border-gray-200 dark:border-gray-700';
                            thumb.innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover" />`;
                            additionalThumbnails.appendChild(thumb);
                        }
                    };
                    reader.readAsDataURL(file);
                }

                if (selectedFiles.files.length === 0) mainThumbnail.innerHTML = '<i class="fas fa-image text-2xl text-gray-300 dark:text-gray-600"></i>';
            }

            function removeFile(index) {
                const dt = new DataTransfer();
                for (let i = 0; i < selectedFiles.files.length; i++) {
                    if (i !== index) dt.items.add(selectedFiles.files[i]);
                }
                selectedFiles = dt;
                fileInput.files = selectedFiles.files;
                renderPreviews();
            }

            // Toggle variants
            toggleVariantsBtn.addEventListener('click', function() {
                variantsVisible = !variantsVisible;
                variantsSection.classList.toggle('hidden', !variantsVisible);
                toggleIcon.className = variantsVisible ? 'fas fa-minus me-1' : 'fas fa-plus me-1';
                toggleText.textContent = variantsVisible ? 'Hide Variants' : 'Add Variants';
                toggleVariantsBtn.className = variantsVisible
                    ? 'inline-flex items-center px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700'
                    : 'inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-gradient-to-br from-purple-600 to-pink-500 rounded-lg hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-purple-300 dark:focus:ring-purple-800';

                if (variantsVisible && variantsContainer.querySelectorAll('.variant-row').length === 0) addVariant();
            });

            function addVariant() {
                const newIndex = variantsContainer.querySelectorAll('.variant-row').length;
                const template = `
                    <div class="variant-row border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-4" data-index="${newIndex}">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-sm font-semibold text-gray-900 dark:text-white">Variant ${newIndex + 1}</span>
                            <button type="button" class="remove-variant-btn text-red-500 hover:text-red-700 text-sm">
                                <i class="fas fa-trash me-1"></i> Remove
                            </button>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Price <span class="text-red-500">*</span></label>
                                <input type="number" step="0.01" name="Variants[${newIndex}].Price" value="0"
                                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">SKU</label>
                                <input type="text" name="Variants[${newIndex}].Sku"
                                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="SKU-001" />
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Quantity</label>
                                <input type="number" name="Variants[${newIndex}].InventoryQuantity" value="0"
                                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Size (Option 1)</label>
                                <input type="text" name="Variants[${newIndex}].Option1"
                                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="e.g. Medium" />
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Color (Option 2)</label>
                                <input type="text" name="Variants[${newIndex}].Option2"
                                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="e.g. Blue" />
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Material (Option 3)</label>
                                <input type="text" name="Variants[${newIndex}].Option3"
                                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="e.g. Cotton" />
                            </div>
                            <div class="sm:col-span-3">
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                    <i class="fas fa-image me-1 text-purple-500"></i> Variant Image
                                </label>
                                <label class="flex flex-col items-center justify-center w-full h-24 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 dark:bg-gray-700 dark:border-gray-600 dark:hover:bg-gray-600">
                                    <input type="file" name="VariantImageFiles[${newIndex}]" accept="image/*" multiple class="variant-file-input hidden" data-variant-index="${newIndex}" />
                                    <div class="flex flex-col items-center justify-center pt-2 pb-2">
                                        <i class="fas fa-cloud-upload-alt text-2xl text-gray-400 mb-1"></i>
                                        <p class="text-xs text-gray-500">Click to upload variant images</p>
                                    </div>
                                </label>
                                <div class="variant-upload-preview mt-2" style="display:none;"></div>
                            </div>
                        </div>
                    </div>
                `;
                variantsContainer.insertAdjacentHTML('beforeend', template);
                updateVariantRemoveButtons();
            }

            addVariantBtn.addEventListener('click', addVariant);

            function updateVariantRemoveButtons() {
                variantsContainer.querySelectorAll('.remove-variant-btn').forEach(btn => {
                    btn.onclick = function() {
                        this.closest('.variant-row').remove();
                        variantsContainer.querySelectorAll('.variant-row').forEach((row, idx) => {
                            row.dataset.index = idx;
                            row.querySelector('span').textContent = `Variant ${idx + 1}`;
                            row.querySelectorAll('input').forEach(input => {
                                input.name = input.name.replace(/Variants\[\d+\]/, `Variants[${idx}]`);
                            });
                        });
                    };
                });
            }

            // Add image URL
            addImageBtn.addEventListener('click', function() {
                const newIndex = imagesContainer.querySelectorAll('.image-row').length;
                const template = `
                    <div class="image-row flex items-center gap-3 mb-3" data-index="${newIndex}">
                        <input type="url" name="ImageUrls[${newIndex}]"
                               class="image-url bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                               placeholder="https://example.com/image.jpg" />
                        <button type="button" class="remove-image-btn text-red-500 hover:text-red-700 p-2" title="Remove">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                imagesContainer.insertAdjacentHTML('beforeend', template);
                updateImageRemoveButtons();
            });

            function updateImageRemoveButtons() {
                const imageRows = imagesContainer.querySelectorAll('.image-row');
                imageRows.forEach((row, idx) => {
                    const removeBtn = row.querySelector('.remove-image-btn');
                    removeBtn.classList.toggle('hidden', imageRows.length <= 1);
                    removeBtn.onclick = function() {
                        row.remove();
                        imagesContainer.querySelectorAll('.image-row').forEach((r, i) => {
                            r.dataset.index = i;
                            r.querySelector('input').name = `ImageUrls[${i}]`;
                        });
                        updateImageRemoveButtons();
                    };
                });
            }

            updateImageRemoveButtons();
        });
    </script>
}
