@page "/admin/settings"
@model Algora.Web.Pages.Admin.SettingsModel
@{
    ViewData["Title"] = "Global Settings";
}

<div class="p-4">
    <!-- Header -->
    <div class="mb-6">
        <h1 class="text-xl font-bold text-gray-900 dark:text-white">Global Settings</h1>
        <p class="text-sm text-gray-500 dark:text-gray-400">Configure API keys and global application settings</p>
    </div>

    <!-- Messages -->
    @if (!string.IsNullOrEmpty(Model.SuccessMessage))
    {
        <div class="flex items-center p-4 mb-6 text-sm text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            @Model.SuccessMessage
        </div>
    }

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="flex items-center p-4 mb-6 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>
            @Model.ErrorMessage
        </div>
    }

    <!-- Tab Navigation -->
    <div class="mb-6 border-b border-gray-200 dark:border-gray-700">
        <ul class="flex flex-wrap -mb-px text-sm font-medium text-center">
            <li class="me-2">
                <a href="/admin/settings?activeTab=ai"
                   class="inline-flex items-center justify-center p-4 border-b-2 rounded-t-lg @(Model.ActiveTab == "ai" ? "text-purple-600 border-purple-600 dark:text-purple-500 dark:border-purple-500" : "border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300")">
                    <i class="fas fa-brain me-2"></i>
                    AI Providers
                </a>
            </li>
            <li class="me-2">
                <a href="/admin/settings?activeTab=scraper"
                   class="inline-flex items-center justify-center p-4 border-b-2 rounded-t-lg @(Model.ActiveTab == "scraper" ? "text-purple-600 border-purple-600 dark:text-purple-500 dark:border-purple-500" : "border-transparent hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300")">
                    <i class="fas fa-spider me-2"></i>
                    Web Scraper
                </a>
            </li>
        </ul>
    </div>

    <!-- AI Providers Tab -->
    @if (Model.ActiveTab == "ai")
    {
        <form method="post" asp-page-handler="SaveAiSettings">
            <!-- Default Providers -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Default Providers</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Default Text Provider</label>
                        <select asp-for="DefaultTextProvider"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200">
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Anthropic</option>
                            <option value="gemini">Google Gemini</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Default Image Provider</label>
                        <select asp-for="DefaultImageProvider"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200">
                            <option value="dalle">DALL-E (OpenAI)</option>
                            <option value="stability">Stability AI</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- OpenAI Settings -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-green-600 to-teal-400 flex items-center justify-center me-3">
                            <i class="fas fa-robot text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">OpenAI</h2>
                            <p class="text-xs text-gray-500 dark:text-gray-400">GPT-4, GPT-3.5, DALL-E</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        @if (Model.Settings.OpenAi.HasApiKey)
                        {
                            <span class="inline-flex items-center bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-green-900 dark:text-green-300">
                                <i class="fas fa-check-circle me-1"></i> Configured
                            </span>
                        }
                        else
                        {
                            <span class="inline-flex items-center bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-yellow-900 dark:text-yellow-300">
                                <i class="fas fa-exclamation-triangle me-1"></i> Not Configured
                            </span>
                        }
                        <button type="button" onclick="testConnection('OpenAi')"
                                class="px-3 py-1.5 text-xs font-medium text-purple-700 bg-purple-100 rounded-lg hover:bg-purple-200 focus:ring-4 focus:outline-none focus:ring-purple-300 dark:bg-purple-900 dark:text-purple-300 dark:hover:bg-purple-800">
                            <i class="fas fa-plug me-1"></i> Test
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="md:col-span-2 lg:col-span-3">
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">API Key</label>
                        <input type="password" asp-for="OpenAiApiKey"
                               placeholder="@(Model.Settings.OpenAi.HasApiKey ? Model.Settings.OpenAi.MaskedApiKey : "sk-...")"
                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all duration-200" />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Leave empty to keep current key</p>
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Text Model</label>
                        <select asp-for="OpenAiTextModel"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200">
                            <option value="gpt-4o">GPT-4o</option>
                            <option value="gpt-4o-mini">GPT-4o Mini</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo</option>
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Image Model</label>
                        <select asp-for="OpenAiImageModel"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200">
                            <option value="dall-e-3">DALL-E 3</option>
                            <option value="dall-e-2">DALL-E 2</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Temperature</label>
                        <input type="number" asp-for="OpenAiTemperature" step="0.1" min="0" max="2"
                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200" />
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Max Tokens</label>
                        <input type="number" asp-for="OpenAiMaxTokens" min="1" max="4096"
                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200" />
                    </div>
                </div>
            </div>

            <!-- Anthropic Settings -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-orange-500 to-amber-400 flex items-center justify-center me-3">
                            <i class="fas fa-comment-dots text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Anthropic</h2>
                            <p class="text-xs text-gray-500 dark:text-gray-400">Claude 3.5, Claude 3</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        @if (Model.Settings.Anthropic.HasApiKey)
                        {
                            <span class="inline-flex items-center bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-green-900 dark:text-green-300">
                                <i class="fas fa-check-circle me-1"></i> Configured
                            </span>
                        }
                        else
                        {
                            <span class="inline-flex items-center bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-yellow-900 dark:text-yellow-300">
                                <i class="fas fa-exclamation-triangle me-1"></i> Not Configured
                            </span>
                        }
                        <button type="button" onclick="testConnection('Anthropic')"
                                class="px-3 py-1.5 text-xs font-medium text-purple-700 bg-purple-100 rounded-lg hover:bg-purple-200 focus:ring-4 focus:outline-none focus:ring-purple-300 dark:bg-purple-900 dark:text-purple-300 dark:hover:bg-purple-800">
                            <i class="fas fa-plug me-1"></i> Test
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="md:col-span-2 lg:col-span-4">
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">API Key</label>
                        <input type="password" asp-for="AnthropicApiKey"
                               placeholder="@(Model.Settings.Anthropic.HasApiKey ? Model.Settings.Anthropic.MaskedApiKey : "sk-ant-...")"
                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all duration-200" />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Leave empty to keep current key</p>
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Model</label>
                        <select asp-for="AnthropicModel"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200">
                            <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                            <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                            <option value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
                            <option value="claude-3-haiku-20240307">Claude 3 Haiku</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Temperature</label>
                        <input type="number" asp-for="AnthropicTemperature" step="0.1" min="0" max="1"
                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200" />
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Max Tokens</label>
                        <input type="number" asp-for="AnthropicMaxTokens" min="1" max="4096"
                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200" />
                    </div>
                </div>
            </div>

            <!-- Gemini Settings -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-600 to-cyan-400 flex items-center justify-center me-3">
                            <i class="fab fa-google text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Google Gemini</h2>
                            <p class="text-xs text-gray-500 dark:text-gray-400">Gemini 1.5 Pro, Gemini 1.5 Flash</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        @if (Model.Settings.Gemini.HasApiKey)
                        {
                            <span class="inline-flex items-center bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-green-900 dark:text-green-300">
                                <i class="fas fa-check-circle me-1"></i> Configured
                            </span>
                        }
                        else
                        {
                            <span class="inline-flex items-center bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-yellow-900 dark:text-yellow-300">
                                <i class="fas fa-exclamation-triangle me-1"></i> Not Configured
                            </span>
                        }
                        <button type="button" onclick="testConnection('Gemini')"
                                class="px-3 py-1.5 text-xs font-medium text-purple-700 bg-purple-100 rounded-lg hover:bg-purple-200 focus:ring-4 focus:outline-none focus:ring-purple-300 dark:bg-purple-900 dark:text-purple-300 dark:hover:bg-purple-800">
                            <i class="fas fa-plug me-1"></i> Test
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="md:col-span-2 lg:col-span-4">
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">API Key</label>
                        <input type="password" asp-for="GeminiApiKey"
                               placeholder="@(Model.Settings.Gemini.HasApiKey ? Model.Settings.Gemini.MaskedApiKey : "AIza...")"
                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all duration-200" />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Leave empty to keep current key</p>
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Model</label>
                        <select asp-for="GeminiModel"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200">
                            <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                            <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                            <option value="gemini-1.0-pro">Gemini 1.0 Pro</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Temperature</label>
                        <input type="number" asp-for="GeminiTemperature" step="0.1" min="0" max="1"
                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200" />
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Max Output Tokens</label>
                        <input type="number" asp-for="GeminiMaxOutputTokens" min="1" max="8192"
                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200" />
                    </div>
                </div>
            </div>

            <!-- Stability AI Settings -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-600 to-pink-500 flex items-center justify-center me-3">
                            <i class="fas fa-image text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Stability AI</h2>
                            <p class="text-xs text-gray-500 dark:text-gray-400">Stable Diffusion XL</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        @if (Model.Settings.StabilityAi.HasApiKey)
                        {
                            <span class="inline-flex items-center bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-green-900 dark:text-green-300">
                                <i class="fas fa-check-circle me-1"></i> Configured
                            </span>
                        }
                        else
                        {
                            <span class="inline-flex items-center bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-yellow-900 dark:text-yellow-300">
                                <i class="fas fa-exclamation-triangle me-1"></i> Not Configured
                            </span>
                        }
                        <button type="button" onclick="testConnection('StabilityAi')"
                                class="px-3 py-1.5 text-xs font-medium text-purple-700 bg-purple-100 rounded-lg hover:bg-purple-200 focus:ring-4 focus:outline-none focus:ring-purple-300 dark:bg-purple-900 dark:text-purple-300 dark:hover:bg-purple-800">
                            <i class="fas fa-plug me-1"></i> Test
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="md:col-span-2 lg:col-span-4">
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">API Key</label>
                        <input type="password" asp-for="StabilityAiApiKey"
                               placeholder="@(Model.Settings.StabilityAi.HasApiKey ? Model.Settings.StabilityAi.MaskedApiKey : "sk-...")"
                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all duration-200" />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Leave empty to keep current key</p>
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Engine</label>
                        <select asp-for="StabilityAiEngine"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200">
                            <option value="stable-diffusion-xl-1024-v1-0">SDXL 1.0</option>
                            <option value="stable-diffusion-v1-6">SD 1.6</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Steps</label>
                        <input type="number" asp-for="StabilityAiSteps" min="10" max="50"
                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200" />
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">CFG Scale</label>
                        <input type="number" asp-for="StabilityAiCfgScale" step="0.5" min="1" max="35"
                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200" />
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="flex justify-end">
                <button type="submit"
                        class="inline-flex items-center px-6 py-3 text-sm font-medium text-white bg-gradient-to-br from-purple-600 to-pink-500 rounded-lg hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-purple-300 dark:focus:ring-purple-800">
                    <i class="fas fa-save me-2"></i> Save AI Settings
                </button>
            </div>
        </form>
    }

    <!-- Scraper Tab -->
    @if (Model.ActiveTab == "scraper")
    {
        <form method="post" asp-page-handler="SaveScraperSettings">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-600 to-violet-500 flex items-center justify-center me-3">
                            <i class="fas fa-spider text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">ScraperAPI</h2>
                            <p class="text-xs text-gray-500 dark:text-gray-400">Web scraping for review imports</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        @if (Model.Settings.ScraperApi.HasApiKey)
                        {
                            <span class="inline-flex items-center bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-green-900 dark:text-green-300">
                                <i class="fas fa-check-circle me-1"></i> Configured
                            </span>
                        }
                        else
                        {
                            <span class="inline-flex items-center bg-yellow-100 text-yellow-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-yellow-900 dark:text-yellow-300">
                                <i class="fas fa-exclamation-triangle me-1"></i> Not Configured
                            </span>
                        }
                        <button type="button" onclick="testConnection('ScraperApi')"
                                class="px-3 py-1.5 text-xs font-medium text-purple-700 bg-purple-100 rounded-lg hover:bg-purple-200 focus:ring-4 focus:outline-none focus:ring-purple-300 dark:bg-purple-900 dark:text-purple-300 dark:hover:bg-purple-800">
                            <i class="fas fa-plug me-1"></i> Test
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="md:col-span-2 lg:col-span-3">
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">API Key</label>
                        <input type="password" asp-for="ScraperApiKey"
                               placeholder="@(Model.Settings.ScraperApi.HasApiKey ? Model.Settings.ScraperApi.MaskedApiKey : "Enter API key...")"
                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-all duration-200" />
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">Leave empty to keep current key</p>
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Provider</label>
                        <select asp-for="ScraperApiProvider"
                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200">
                            <option value="ScraperAPI">ScraperAPI</option>
                            <option value="Bright Data">Bright Data</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Country Code</label>
                        <input type="text" asp-for="ScraperApiCountryCode" maxlength="2"
                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200" />
                    </div>
                    <div>
                        <label class="block mb-2 text-sm font-bold text-slate-700 dark:text-white">Timeout (seconds)</label>
                        <input type="number" asp-for="ScraperApiTimeoutSeconds" min="10" max="300"
                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-fuchsia-500 focus:border-fuchsia-500 focus:shadow-soft-primary-outline block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white transition-all duration-200" />
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" asp-for="ScraperApiEnabled"
                               class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500 dark:focus:ring-purple-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600" />
                        <label class="ms-2 text-sm font-medium text-gray-900 dark:text-gray-300">Enabled</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" asp-for="ScraperApiRenderJs"
                               class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500 dark:focus:ring-purple-600 dark:ring-offset-gray-800 dark:bg-gray-700 dark:border-gray-600" />
                        <label class="ms-2 text-sm font-medium text-gray-900 dark:text-gray-300">Render JavaScript</label>
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="flex justify-end">
                <button type="submit"
                        class="inline-flex items-center px-6 py-3 text-sm font-medium text-white bg-gradient-to-br from-purple-600 to-pink-500 rounded-lg hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-purple-300 dark:focus:ring-purple-800">
                    <i class="fas fa-save me-2"></i> Save Scraper Settings
                </button>
            </div>
        </form>
    }
</div>

<!-- Test Result Toast -->
<div id="testResultToast" class="fixed bottom-4 right-4 hidden z-50">
    <div id="testResultContent" class="flex items-center p-4 mb-4 text-sm rounded-lg shadow-lg" role="alert">
        <i id="testResultIcon" class="me-2"></i>
        <span id="testResultMessage"></span>
    </div>
</div>

@section Scripts {
    <script>
        async function testConnection(provider) {
            const toast = document.getElementById('testResultToast');
            const content = document.getElementById('testResultContent');
            const icon = document.getElementById('testResultIcon');
            const message = document.getElementById('testResultMessage');

            // Show loading
            content.className = 'flex items-center p-4 mb-4 text-sm rounded-lg shadow-lg bg-blue-50 text-blue-800 dark:bg-gray-800 dark:text-blue-400';
            icon.className = 'fas fa-spinner fa-spin me-2';
            message.textContent = 'Testing connection...';
            toast.classList.remove('hidden');

            try {
                const response = await fetch(`/admin/settings?handler=Test${provider}`, {
                    method: 'POST',
                    headers: {
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    }
                });

                const result = await response.json();

                if (result.success) {
                    content.className = 'flex items-center p-4 mb-4 text-sm rounded-lg shadow-lg bg-green-50 text-green-800 dark:bg-gray-800 dark:text-green-400';
                    icon.className = 'fas fa-check-circle me-2';
                    message.textContent = result.message || 'Connection successful!';
                } else {
                    content.className = 'flex items-center p-4 mb-4 text-sm rounded-lg shadow-lg bg-red-50 text-red-800 dark:bg-gray-800 dark:text-red-400';
                    icon.className = 'fas fa-times-circle me-2';
                    message.textContent = result.error || 'Connection failed';
                }
            } catch (error) {
                content.className = 'flex items-center p-4 mb-4 text-sm rounded-lg shadow-lg bg-red-50 text-red-800 dark:bg-gray-800 dark:text-red-400';
                icon.className = 'fas fa-times-circle me-2';
                message.textContent = 'Network error: ' + error.message;
            }

            // Hide after 5 seconds
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 5000);
        }
    </script>
}
