@page "/auth/register"
@model Algora.Web.Pages.Auth.RegisterModel
@{
    ViewData["Title"] = "Sign Up";
    Layout = "_AuthLayout";
}

<div>
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Create an account</h2>
    <p class="text-sm text-gray-500 dark:text-gray-400 mb-8">Join Algora to start managing your store</p>

    <form method="post" id="registerForm">
        <div asp-validation-summary="ModelOnly" class="text-red-500 mb-4"></div>

        @if (!string.IsNullOrEmpty(Model.ErrorMessage))
        {
            <div class="flex items-center p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400" role="alert">
                <i class="fas fa-exclamation-circle me-2"></i>
                @Model.ErrorMessage
            </div>
        }

        <!-- Shop URL Field -->
        <div class="mb-4">
            <label asp-for="Input.ShopDomain" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Shop URL</label>
            <input asp-for="Input.ShopDomain" type="text" id="shopDomain"
                   class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                   placeholder="your-store.myshopify.com" />
            <span asp-validation-for="Input.ShopDomain" class="text-red-500 text-xs"></span>
        </div>

        <!-- Name Field -->
        <div class="mb-4">
            <label asp-for="Input.Name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Full Name</label>
            <input asp-for="Input.Name" type="text"
                   class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                   placeholder="Name" />
            <span asp-validation-for="Input.Name" class="text-red-500 text-xs"></span>
        </div>

        <!-- Email Field -->
        <div class="mb-4">
            <label asp-for="Input.Email" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Email</label>
            <input asp-for="Input.Email" type="email" id="email"
                   class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                   placeholder="Email" />
            <span asp-validation-for="Input.Email" class="text-red-500 text-xs"></span>
        </div>

        <!-- Password Field -->
        <div class="mb-4">
            <label asp-for="Input.Password" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Password</label>
            <input asp-for="Input.Password" type="password" id="password"
                   class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                   placeholder="Password" />
            <span asp-validation-for="Input.Password" class="text-red-500 text-xs"></span>
            <!-- Password Strength Indicator -->
            <div id="passwordStrength" class="mt-2 hidden">
                <div class="flex gap-1 mb-1">
                    <div id="strengthBar1" class="h-1 w-1/4 bg-gray-200 rounded"></div>
                    <div id="strengthBar2" class="h-1 w-1/4 bg-gray-200 rounded"></div>
                    <div id="strengthBar3" class="h-1 w-1/4 bg-gray-200 rounded"></div>
                    <div id="strengthBar4" class="h-1 w-1/4 bg-gray-200 rounded"></div>
                </div>
                <p id="strengthText" class="text-xs text-gray-500"></p>
            </div>
            <!-- Password Requirements -->
            <ul class="mt-2 text-xs text-gray-500 space-y-1" id="passwordRequirements">
                <li id="reqLength" class="flex items-center gap-1">
                    <span class="req-icon">○</span> At least 8 characters
                </li>
                <li id="reqUpper" class="flex items-center gap-1">
                    <span class="req-icon">○</span> One uppercase letter
                </li>
                <li id="reqLower" class="flex items-center gap-1">
                    <span class="req-icon">○</span> One lowercase letter
                </li>
                <li id="reqNumber" class="flex items-center gap-1">
                    <span class="req-icon">○</span> One number
                </li>
                <li id="reqSpecial" class="flex items-center gap-1">
                    <span class="req-icon">○</span> One special character
                </li>
            </ul>
        </div>

        <!-- Confirm Password Field -->
        <div class="mb-4">
            <label asp-for="Input.ConfirmPassword" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Confirm Password</label>
            <input asp-for="Input.ConfirmPassword" type="password" id="confirmPassword"
                   class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white"
                   placeholder="Confirm Password" />
            <span asp-validation-for="Input.ConfirmPassword" class="text-red-500 text-xs"></span>
            <p id="passwordMatch" class="text-xs mt-1 hidden"></p>
        </div>

        <!-- Terms Checkbox -->
        <div class="flex items-start mb-6">
            <div class="flex items-center h-5">
                <input asp-for="Input.AgreeTerms" id="agreeTerms" type="checkbox"
                       class="w-4 h-4 text-purple-600 bg-gray-100 border-gray-300 rounded focus:ring-purple-500 dark:focus:ring-purple-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600" />
            </div>
            <label for="agreeTerms" class="ms-2 text-sm font-medium text-gray-900 dark:text-gray-300">
                I agree to the <a href="#" class="text-purple-600 hover:underline dark:text-purple-400">Terms and Conditions</a>
            </label>
        </div>
        <span asp-validation-for="Input.AgreeTerms" class="text-red-500 text-xs block -mt-4 mb-4"></span>

        <button type="submit" id="submitBtn"
                class="w-full text-white bg-gradient-to-br from-purple-600 to-pink-500 hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-purple-300 dark:focus:ring-purple-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
            Sign up
        </button>

        <p class="mt-4 text-sm text-gray-500 dark:text-gray-400">
            Already have an account?
            <a asp-page="/Auth/Login" class="text-purple-600 hover:underline dark:text-purple-400 font-medium">Sign in</a>
        </p>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const emailInput = document.getElementById('email');
            const shopDomainInput = document.getElementById('shopDomain');
            const passwordStrength = document.getElementById('passwordStrength');
            const passwordMatch = document.getElementById('passwordMatch');
            
            // Password strength checking
            passwordInput.addEventListener('input', function() {
                const password = this.value;
                passwordStrength.classList.remove('hidden');
                
                // Check requirements
                const hasLength = password.length >= 8;
                const hasUpper = /[A-Z]/.test(password);
                const hasLower = /[a-z]/.test(password);
                const hasNumber = /\d/.test(password);
                const hasSpecial = /[^\da-zA-Z]/.test(password);
                
                // Update requirement indicators
                updateRequirement('reqLength', hasLength);
                updateRequirement('reqUpper', hasUpper);
                updateRequirement('reqLower', hasLower);
                updateRequirement('reqNumber', hasNumber);
                updateRequirement('reqSpecial', hasSpecial);
                
                // Calculate strength
                const strength = [hasLength, hasUpper, hasLower, hasNumber, hasSpecial].filter(Boolean).length;
                updateStrengthBars(strength);
                
                // Check password match if confirm field has value
                if (confirmPasswordInput.value) {
                    checkPasswordMatch();
                }
            });
            
            // Password match checking
            confirmPasswordInput.addEventListener('input', checkPasswordMatch);
            
            function checkPasswordMatch() {
                const password = passwordInput.value;
                const confirmPassword = confirmPasswordInput.value;
                
                if (confirmPassword) {
                    passwordMatch.classList.remove('hidden');
                    if (password === confirmPassword) {
                        passwordMatch.textContent = '✓ Passwords match';
                        passwordMatch.className = 'text-xs mt-1 text-green-600';
                    } else {
                        passwordMatch.textContent = '✗ Passwords do not match';
                        passwordMatch.className = 'text-xs mt-1 text-red-600';
                    }
                } else {
                    passwordMatch.classList.add('hidden');
                }
            }
            
            function updateRequirement(elementId, isMet) {
                const element = document.getElementById(elementId);
                const icon = element.querySelector('.req-icon');
                if (isMet) {
                    icon.textContent = '✓';
                    element.classList.add('text-green-600');
                    element.classList.remove('text-gray-500');
                } else {
                    icon.textContent = '○';
                    element.classList.remove('text-green-600');
                    element.classList.add('text-gray-500');
                }
            }
            
            function updateStrengthBars(strength) {
                const bars = ['strengthBar1', 'strengthBar2', 'strengthBar3', 'strengthBar4'];
                const colors = ['bg-red-500', 'bg-orange-500', 'bg-yellow-500', 'bg-green-500'];
                const texts = ['Weak', 'Fair', 'Good', 'Strong'];
                const strengthText = document.getElementById('strengthText');
                
                bars.forEach((barId, index) => {
                    const bar = document.getElementById(barId);
                    bar.className = 'h-1 w-1/4 rounded';
                    
                    if (index < strength - 1) {
                        bar.classList.add(colors[Math.min(strength - 2, 3)]);
                    } else {
                        bar.classList.add('bg-gray-200');
                    }
                });
                
                if (strength > 1) {
                    strengthText.textContent = texts[Math.min(strength - 2, 3)];
                    strengthText.className = 'text-xs ' + (strength >= 4 ? 'text-green-600' : strength >= 3 ? 'text-yellow-600' : 'text-red-600');
                } else {
                    strengthText.textContent = '';
                }
            }
            
            // Email validation with visual feedback
            emailInput.addEventListener('blur', function() {
                const email = this.value;
                const emailRegex = /^[^\s@@]+@@[^\s@@]+\.[^\s@@]+$/;
                
                if (email && !emailRegex.test(email)) {
                    this.classList.add('border-red-500');
                    this.classList.remove('border-gray-300');
                } else {
                    this.classList.remove('border-red-500');
                    this.classList.add('border-gray-300');
                }
            });
            
            // Shop domain formatting
            shopDomainInput.addEventListener('blur', function() {
                let value = this.value.trim().toLowerCase();
                
                // Remove https://, http://, and trailing slashes
                value = value.replace(/^https?:\/\//, '').replace(/\/$/, '');
                
                // Auto-append .myshopify.com if not present
                if (value && !value.includes('.myshopify.com') && !value.includes('.')) {
                    value = value + '.myshopify.com';
                }
                
                this.value = value;
                
                // Validate format
                const shopRegex = /^[a-zA-Z0-9][a-zA-Z0-9\-]*\.myshopify\.com$/;
                if (value && !shopRegex.test(value)) {
                    this.classList.add('border-red-500');
                    this.classList.remove('border-gray-300');
                } else {
                    this.classList.remove('border-red-500');
                    this.classList.add('border-gray-300');
                }
            });
        });
    </script>
}