@page "/analytics/adsspend"
@model Algora.Web.Pages.Analytics.AdsSpendModel
@{
    ViewData["Title"] = "Ads Spend & ROAS";
}

<div class="p-4">
    <!-- Header -->
    <div class="flex flex-wrap items-center justify-between mb-6">
        <div>
            <h1 class="text-xl font-bold text-gray-900 dark:text-white">Ads Spend & ROAS Management</h1>
            <p class="text-sm text-gray-500 dark:text-gray-400">
                <i class="fa fa-ad text-green-500 me-1"></i>
                Track advertising performance for <span class="font-semibold">@Model.GetPeriodLabel()</span>
            </p>
        </div>

        <a href="/analytics" class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 dark:bg-gray-800 dark:text-white dark:border-gray-600 dark:hover:bg-gray-700">
            <i class="fas fa-arrow-left me-2"></i> Back
        </a>
    </div>

    <!-- Time Period Selector -->
    <div class="flex items-center gap-2 mb-6">
        <span class="text-sm text-gray-600 dark:text-gray-400 mr-2">Period:</span>
        <div class="inline-flex rounded-lg border border-gray-200 dark:border-gray-700" role="group">
            <a href="?period=today" class="px-3 py-2 text-xs font-medium @(Model.SelectedPeriod == "today" ? "bg-gradient-to-br from-purple-600 to-pink-500 text-white" : "bg-white dark:bg-gray-800 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-700") rounded-l-lg border-r border-gray-200 dark:border-gray-700">
                Today
            </a>
            <a href="?period=7days" class="px-3 py-2 text-xs font-medium @(Model.SelectedPeriod == "7days" ? "bg-gradient-to-br from-purple-600 to-pink-500 text-white" : "bg-white dark:bg-gray-800 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-700") border-r border-gray-200 dark:border-gray-700">
                7 days
            </a>
            <a href="?period=30days" class="px-3 py-2 text-xs font-medium @(Model.SelectedPeriod == "30days" ? "bg-gradient-to-br from-purple-600 to-pink-500 text-white" : "bg-white dark:bg-gray-800 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-700") border-r border-gray-200 dark:border-gray-700">
                30 days
            </a>
            <a href="?period=90days" class="px-3 py-2 text-xs font-medium @(Model.SelectedPeriod == "90days" ? "bg-gradient-to-br from-purple-600 to-pink-500 text-white" : "bg-white dark:bg-gray-800 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-700") border-r border-gray-200 dark:border-gray-700">
                90 days
            </a>
            <a href="?period=12months" class="px-3 py-2 text-xs font-medium @(Model.SelectedPeriod == "12months" ? "bg-gradient-to-br from-purple-600 to-pink-500 text-white" : "bg-white dark:bg-gray-800 text-gray-700 dark:text-white hover:bg-gray-50 dark:hover:bg-gray-700") rounded-r-lg">
                12 months
            </a>
        </div>
    </div>

    @if (!string.IsNullOrEmpty(Model.SuccessMessage))
    {
        <div class="mb-4 p-4 text-sm text-green-800 rounded-lg bg-green-50 dark:bg-gray-800 dark:text-green-400" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            @Model.SuccessMessage
        </div>
    }

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="mb-4 p-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            @Model.ErrorMessage
        </div>
    }

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-6">
        <!-- Total Spend -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Total Spend</p>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">@Model.Summary.TotalSpend.ToString("C0")</h3>
                </div>
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-red-500 to-rose-400 flex items-center justify-center">
                    <i class="fas fa-money-bill-wave text-white text-lg"></i>
                </div>
            </div>
        </div>

        <!-- Revenue from Ads -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Revenue</p>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">@Model.Summary.TotalRevenue.ToString("C0")</h3>
                </div>
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-green-500 to-lime-400 flex items-center justify-center">
                    <i class="fas fa-chart-bar text-white text-lg"></i>
                </div>
            </div>
        </div>

        <!-- ROAS -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">ROAS</p>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">@Model.Summary.OverallROAS.ToString("F2")x</h3>
                    <span class="text-xs text-gray-500 dark:text-gray-400">Return on ad spend</span>
                </div>
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-purple-600 to-pink-500 flex items-center justify-center">
                    <i class="fas fa-percentage text-white text-lg"></i>
                </div>
            </div>
        </div>

        <!-- Conversions -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Conversions</p>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">@Model.Summary.TotalConversions.ToString("N0")</h3>
                </div>
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-blue-600 to-cyan-400 flex items-center justify-center">
                    <i class="fas fa-shopping-cart text-white text-lg"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Platform Breakdown -->
    @if (Model.Summary.ByPlatform.Any())
    {
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md mb-6">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <h6 class="text-lg font-semibold text-gray-900 dark:text-white">Platform Breakdown</h6>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    @foreach (var platform in Model.Summary.ByPlatform)
                    {
                        <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600">
                            <h6 class="mb-2 text-sm font-bold text-gray-900 dark:text-white">@platform.Platform</h6>
                            <div class="space-y-1">
                                <div class="flex justify-between">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">Spend:</span>
                                    <span class="text-xs font-semibold text-gray-900 dark:text-white">@platform.Spend.ToString("C0") (@platform.SpendPercentage.ToString("F1")%)</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">Revenue:</span>
                                    <span class="text-xs font-semibold text-gray-900 dark:text-white">@platform.Revenue.ToString("C0")</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">ROAS:</span>
                                    <span class="text-xs font-semibold @(platform.ROAS >= 2 ? "text-green-600" : platform.ROAS >= 1 ? "text-orange-500" : "text-red-600")">@platform.ROAS.ToString("F2")x</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-xs text-gray-500 dark:text-gray-400">Conversions:</span>
                                    <span class="text-xs font-semibold text-gray-900 dark:text-white">@platform.Conversions</span>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    }

    <!-- Add New Spend Entry Form -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md mb-6">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <h6 class="text-lg font-semibold text-gray-900 dark:text-white">Add Ads Spend Entry</h6>
            <p class="text-sm text-gray-500 dark:text-gray-400">
                <i class="fa fa-plus-circle text-purple-500"></i>
                <span class="font-semibold">Track your advertising spend</span>
            </p>
        </div>
        <div class="p-6">
            <form method="post">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Platform -->
                    <div>
                        <label class="block mb-2 text-sm font-bold text-gray-700 dark:text-white" asp-for="Input.Platform">Platform</label>
                        <select asp-for="Input.Platform" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <option value="Facebook">Facebook</option>
                            <option value="Google">Google</option>
                            <option value="Instagram">Instagram</option>
                            <option value="TikTok">TikTok</option>
                            <option value="Twitter">Twitter</option>
                            <option value="LinkedIn">LinkedIn</option>
                            <option value="Other">Other</option>
                        </select>
                        <span asp-validation-for="Input.Platform" class="text-xs text-red-600"></span>
                    </div>

                    <!-- Campaign Name -->
                    <div>
                        <label class="block mb-2 text-sm font-bold text-gray-700 dark:text-white" asp-for="Input.CampaignName">Campaign Name</label>
                        <input type="text" asp-for="Input.CampaignName" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white" placeholder="e.g., Summer Sale 2024" />
                        <span asp-validation-for="Input.CampaignName" class="text-xs text-red-600"></span>
                    </div>

                    <!-- Spend Date -->
                    <div>
                        <label class="block mb-2 text-sm font-bold text-gray-700 dark:text-white" asp-for="Input.SpendDate">Date</label>
                        <input type="date" asp-for="Input.SpendDate" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white" />
                        <span asp-validation-for="Input.SpendDate" class="text-xs text-red-600"></span>
                    </div>

                    <!-- Amount -->
                    <div>
                        <label class="block mb-2 text-sm font-bold text-gray-700 dark:text-white" asp-for="Input.Amount">Amount Spent</label>
                        <input type="number" step="0.01" asp-for="Input.Amount" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white" placeholder="0.00" />
                        <span asp-validation-for="Input.Amount" class="text-xs text-red-600"></span>
                    </div>

                    <!-- Currency -->
                    <div>
                        <label class="block mb-2 text-sm font-bold text-gray-700 dark:text-white" asp-for="Input.Currency">Currency</label>
                        <select asp-for="Input.Currency" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <option value="USD">USD</option>
                            <option value="EUR">EUR</option>
                            <option value="GBP">GBP</option>
                        </select>
                        <span asp-validation-for="Input.Currency" class="text-xs text-red-600"></span>
                    </div>

                    <!-- Impressions -->
                    <div>
                        <label class="block mb-2 text-sm font-bold text-gray-700 dark:text-white" asp-for="Input.Impressions">Impressions</label>
                        <input type="number" asp-for="Input.Impressions" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white" placeholder="Optional" />
                        <span asp-validation-for="Input.Impressions" class="text-xs text-red-600"></span>
                    </div>

                    <!-- Clicks -->
                    <div>
                        <label class="block mb-2 text-sm font-bold text-gray-700 dark:text-white" asp-for="Input.Clicks">Clicks</label>
                        <input type="number" asp-for="Input.Clicks" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white" placeholder="Optional" />
                        <span asp-validation-for="Input.Clicks" class="text-xs text-red-600"></span>
                    </div>

                    <!-- Conversions -->
                    <div>
                        <label class="block mb-2 text-sm font-bold text-gray-700 dark:text-white" asp-for="Input.Conversions">Conversions</label>
                        <input type="number" asp-for="Input.Conversions" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white" placeholder="Optional" />
                        <span asp-validation-for="Input.Conversions" class="text-xs text-red-600"></span>
                    </div>

                    <!-- Revenue -->
                    <div>
                        <label class="block mb-2 text-sm font-bold text-gray-700 dark:text-white" asp-for="Input.Revenue">Revenue Generated</label>
                        <input type="number" step="0.01" asp-for="Input.Revenue" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white" placeholder="Optional" />
                        <span asp-validation-for="Input.Revenue" class="text-xs text-red-600"></span>
                    </div>
                </div>

                <!-- Notes -->
                <div class="mt-4">
                    <label class="block mb-2 text-sm font-bold text-gray-700 dark:text-white" asp-for="Input.Notes">Notes</label>
                    <textarea asp-for="Input.Notes" rows="2" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-purple-500 focus:border-purple-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white" placeholder="Additional notes..."></textarea>
                    <span asp-validation-for="Input.Notes" class="text-xs text-red-600"></span>
                </div>

                <!-- Submit Button -->
                <div class="mt-6">
                    <button type="submit" class="inline-flex items-center px-6 py-2.5 text-sm font-medium text-white bg-gradient-to-br from-purple-600 to-pink-500 hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-purple-300 rounded-lg dark:focus:ring-purple-800">
                        <i class="fas fa-save me-2"></i> Save Entry
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ads Spend Entries Table -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
            <h6 class="text-lg font-semibold text-gray-900 dark:text-white">Ads Spend Entries</h6>
            <p class="text-sm text-gray-500 dark:text-gray-400">
                <i class="fa fa-list text-blue-500"></i>
                <span class="font-semibold">@Model.AdsSpendList.Count entries</span> for this period
            </p>
        </div>
        <div class="p-6">
            @if (Model.AdsSpendList.Any())
            {
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                            <tr>
                                <th scope="col" class="px-6 py-3">Date</th>
                                <th scope="col" class="px-6 py-3">Platform</th>
                                <th scope="col" class="px-6 py-3">Campaign</th>
                                <th scope="col" class="px-6 py-3 text-center">Spend</th>
                                <th scope="col" class="px-6 py-3 text-center">Revenue</th>
                                <th scope="col" class="px-6 py-3 text-center">ROAS</th>
                                <th scope="col" class="px-6 py-3 text-center">Conversions</th>
                                <th scope="col" class="px-6 py-3 text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var entry in Model.AdsSpendList.OrderByDescending(e => e.SpendDate))
                            {
                                <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                                    <td class="px-6 py-4 text-gray-900 dark:text-white">@entry.SpendDate.ToString("MMM dd, yyyy")</td>
                                    <td class="px-6 py-4">
                                        <span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-blue-900 dark:text-blue-300">
                                            @entry.Platform
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 text-gray-900 dark:text-white">@(entry.CampaignName ?? "N/A")</td>
                                    <td class="px-6 py-4 text-center font-semibold text-gray-900 dark:text-white">@entry.Amount.ToString("C2")</td>
                                    <td class="px-6 py-4 text-center font-semibold text-gray-900 dark:text-white">@(entry.Revenue?.ToString("C2") ?? "N/A")</td>
                                    <td class="px-6 py-4 text-center">
                                        @if (entry.ROAS.HasValue)
                                        {
                                            var roasClass = entry.ROAS >= 2 ? "text-green-600" : entry.ROAS >= 1 ? "text-orange-500" : "text-red-600";
                                            <span class="font-semibold @roasClass">@entry.ROAS.Value.ToString("F2")x</span>
                                        }
                                        else
                                        {
                                            <span class="text-gray-400">N/A</span>
                                        }
                                    </td>
                                    <td class="px-6 py-4 text-center font-semibold text-gray-900 dark:text-white">@(entry.Conversions?.ToString() ?? "N/A")</td>
                                    <td class="px-6 py-4 text-center">
                                        <form method="post" asp-page-handler="Delete" asp-route-id="@entry.Id" onsubmit="return confirm('Are you sure you want to delete this entry?');" class="inline">
                                            <button type="submit" class="inline-flex items-center px-3 py-1.5 text-xs font-medium text-white bg-gradient-to-br from-red-500 to-rose-400 hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-red-300 rounded-lg dark:focus:ring-red-800">
                                                <i class="fas fa-trash me-1"></i> Delete
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-center py-12">
                    <i class="fas fa-ad fa-4x text-gray-300 mb-4"></i>
                    <p class="text-gray-500 dark:text-gray-400">No ads spend entries for this period.</p>
                    <p class="text-sm text-gray-400 dark:text-gray-500">Add an entry above to start tracking your advertising performance.</p>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
