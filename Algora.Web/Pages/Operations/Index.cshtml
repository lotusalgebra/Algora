@page "/operations"
@model Algora.Web.Pages.Operations.IndexModel
@{
    ViewData["Title"] = "Operations Manager";
}

<div class="p-4">
    <!-- Page Header -->
    <div class="mb-6">
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Operations Manager</h1>
        <p class="text-sm text-gray-500 dark:text-gray-400">Manage suppliers, purchase orders, and inventory locations</p>
    </div>

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-6">
        <!-- Active Suppliers -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Active Suppliers</p>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">@Model.ActiveSupplierCount</h3>
                </div>
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-purple-600 to-pink-500 flex items-center justify-center">
                    <i class="fas fa-truck text-white text-lg"></i>
                </div>
            </div>
        </div>

        <!-- Pending Orders -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Pending Orders</p>
                    <h3 class="text-2xl font-bold text-blue-600 dark:text-blue-400">@Model.PendingPurchaseOrderCount</h3>
                    <p class="text-xs text-gray-400">$@Model.TotalPendingOrderValue.ToString("N2") total</p>
                </div>
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-blue-600 to-cyan-400 flex items-center justify-center">
                    <i class="fas fa-file-invoice text-white text-lg"></i>
                </div>
            </div>
        </div>

        <!-- Locations -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Locations</p>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white">@Model.LocationCount</h3>
                </div>
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-green-600 to-lime-400 flex items-center justify-center">
                    <i class="fas fa-warehouse text-white text-lg"></i>
                </div>
            </div>
        </div>

        <!-- Low Stock Products -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Low Stock Products</p>
                    <h3 class="text-2xl font-bold @(Model.LowStockProductCount > 0 ? "text-orange-600" : "text-gray-900 dark:text-white")">@Model.LowStockProductCount</h3>
                </div>
                <div class="w-12 h-12 rounded-lg bg-gradient-to-br from-orange-500 to-yellow-400 flex items-center justify-center">
                    <i class="fas fa-exclamation-triangle text-white text-lg"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Quick Actions</h2>
        <div class="flex flex-wrap gap-3">
            <a href="/operations/suppliers" class="inline-flex items-center px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-br from-purple-600 to-pink-500 rounded-lg hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-purple-300 dark:focus:ring-purple-800">
                <i class="fas fa-truck me-2"></i> Manage Suppliers
            </a>
            <a href="/operations/purchase-orders" class="inline-flex items-center px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-br from-blue-600 to-cyan-400 rounded-lg hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-blue-300">
                <i class="fas fa-file-invoice me-2"></i> Purchase Orders
            </a>
            <a href="/operations/locations" class="inline-flex items-center px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-br from-green-600 to-lime-400 rounded-lg hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-green-300">
                <i class="fas fa-warehouse me-2"></i> Locations
            </a>
            <a href="/operations/barcodes" class="inline-flex items-center px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-br from-gray-700 to-gray-500 rounded-lg hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-gray-300">
                <i class="fas fa-barcode me-2"></i> Barcode Generator
            </a>
            <a href="/operations/packing-slips" class="inline-flex items-center px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-br from-indigo-600 to-purple-500 rounded-lg hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-indigo-300">
                <i class="fas fa-file-alt me-2"></i> Packing Slips
            </a>
            <a href="/operations/label-designer" class="inline-flex items-center px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-br from-pink-500 to-rose-400 rounded-lg hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-pink-300">
                <i class="fas fa-tags me-2"></i> Label Designer
            </a>
            <a href="/operations/thresholds" class="inline-flex items-center px-4 py-2.5 text-sm font-medium text-white bg-gradient-to-br from-orange-500 to-yellow-400 rounded-lg hover:bg-gradient-to-bl focus:ring-4 focus:outline-none focus:ring-orange-300">
                <i class="fas fa-sliders-h me-2"></i> Inventory Thresholds
            </a>
        </div>
    </div>

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="flex items-center p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span>@Model.ErrorMessage</span>
        </div>
    }

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Recent Purchase Orders -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
            <div class="p-6 pb-4 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Recent Purchase Orders</h2>
                    <a href="/operations/purchase-orders" class="text-sm text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300">View All</a>
                </div>
            </div>
            <div class="p-6">
                @if (Model.RecentPurchaseOrders.Count == 0)
                {
                    <div class="text-center py-8">
                        <i class="fas fa-file-invoice text-5xl text-gray-300 dark:text-gray-600 mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400 mb-2">No purchase orders yet.</p>
                        <a href="/operations/purchase-orders/create" class="text-purple-600 hover:text-purple-800 dark:text-purple-400">Create your first order</a>
                    </div>
                }
                else
                {
                    <div class="space-y-3">
                        @foreach (var order in Model.RecentPurchaseOrders)
                        {
                            var statusBadge = order.Status switch
                            {
                                "draft" => "bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",
                                "sent" => "bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",
                                "confirmed" => "bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300",
                                "shipped" => "bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",
                                "received" => "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",
                                "cancelled" => "bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",
                                _ => "bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"
                            };

                            <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <div>
                                    <h6 class="text-sm font-semibold text-gray-900 dark:text-white">@order.OrderNumber</h6>
                                    <span class="text-xs text-gray-500 dark:text-gray-400">@order.SupplierName</span>
                                </div>
                                <div class="text-right">
                                    <span class="@statusBadge text-xs font-medium px-2.5 py-0.5 rounded mb-1 inline-block">@order.Status</span>
                                    <p class="text-sm font-bold text-gray-900 dark:text-white">$@order.Total.ToString("N2")</p>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>

        <!-- Suggested Reorders -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
            <div class="p-6 pb-4 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Suggested Reorders</h2>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Products that need reordering based on sales velocity</p>
                    </div>
                    <a href="/operations/purchase-orders/create" class="text-sm text-purple-600 hover:text-purple-800 dark:text-purple-400 dark:hover:text-purple-300">Create Order</a>
                </div>
            </div>
            <div class="p-6">
                @if (Model.SuggestedOrders.Count == 0)
                {
                    <div class="text-center py-8">
                        <i class="fas fa-check-circle text-5xl text-green-300 dark:text-green-600 mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400">No suggested reorders. Inventory levels are healthy!</p>
                    </div>
                }
                else
                {
                    <div class="space-y-3">
                        @foreach (var suggestion in Model.SuggestedOrders)
                        {
                            @foreach (var line in suggestion.Lines.Take(3))
                            {
                                var urgencyColor = line.DaysUntilStockout switch
                                {
                                    <= 3 => "text-red-600 dark:text-red-400",
                                    <= 7 => "text-orange-600 dark:text-orange-400",
                                    <= 14 => "text-yellow-600 dark:text-yellow-400",
                                    _ => "text-gray-600 dark:text-gray-400"
                                };

                                <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                    <div>
                                        <h6 class="text-sm font-semibold text-gray-900 dark:text-white">@line.ProductTitle</h6>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">
                                            Current: @line.CurrentStock | Reorder: @line.SuggestedQuantity
                                        </span>
                                    </div>
                                    <div class="text-right">
                                        <span class="text-sm font-bold @urgencyColor">
                                            @(line.DaysUntilStockout >= 9999 ? "In Stock" : $"{line.DaysUntilStockout} days")
                                        </span>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">@suggestion.SupplierName</p>
                                    </div>
                                </div>
                            }
                        }
                    </div>
                }
            </div>
        </div>
    </div>
</div>
